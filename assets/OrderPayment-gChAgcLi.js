import{b as E,F as _,g as M,h as R,i as U,j as L,a as O,S as H,k as j}from"./validationRules-BRXNUbOj.js";import{d as b,o as f,b as k,m as D,u as n,_ as C,p as S,q,c as V,a as r,k as Z,s as $,h as p,T as z,w as h,t as J,v as G,x as F,n as c,r as K,y as Q,z as W,A as y,B as X,e as x,g as Y,f as ee,j as ae}from"./index-BKa3u2Xd.js";import{P as te,F as le}from"./PaymentFooter-de6-gIbJ.js";import"./messages-D5fpFi7l.js";const oe="/payment-scenario/assets/bank_logo-BycS5gqS.svg",re=e=>e.replace(/\s/g,""),se=e=>(e.replace(/\D/g,"").match(/.{1,4}/g)||[]).join(" ").substr(0,19),ne=b({__name:"CardNumberInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",placeholder:e.placeholder||"0000 0000 0000 0000",icon:e.icon,error:e.error,rules:n(E),"model-value":e.modelValue,formatter:n(se),parser:n(re),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"card-number-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),ue=C(ne,[["__scopeId","data-v-c4427637"]]),de=b({__name:"ExpireDateInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-exp",placeholder:e.placeholder||"MM / ГГ",icon:e.icon,error:e.error,rules:n(U),"model-value":e.modelValue,formatter:n(R),parser:n(M),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"expire-date-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),ce=C(de,[["__scopeId","data-v-bd8f1216"]]),ie=e=>e.replace(/\D/g,"").slice(0,4),me=e=>e.replace(/\D/g,""),pe="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='9'%20cy='9'%20r='9'%20fill='%23F2F2F2'/%3e%3cpath%20d='M5.97852%207.34766H7.47021C7.521%206.56055%208.04785%206.05908%208.8667%206.05908C9.6665%206.05908%2010.1997%206.54785%2010.1997%207.2207C10.1997%207.84912%209.93311%208.19189%209.146%208.66797C8.27002%209.18213%207.90186%209.75342%207.95898%2010.6929L7.96533%2011.1436H9.43799V10.7754C9.43799%2010.1406%209.67285%209.81055%2010.5044%209.32812C11.3677%208.81396%2011.8501%208.13477%2011.8501%207.16357C11.8501%205.76709%2010.6885%204.76416%208.94922%204.76416C7.06396%204.76416%206.0293%205.85596%205.97852%207.34766ZM8.7207%2014.127C9.23486%2014.127%209.64111%2013.7271%209.64111%2013.2256C9.64111%2012.7241%209.23486%2012.3306%208.7207%2012.3306C8.20654%2012.3306%207.79395%2012.7241%207.79395%2013.2256C7.79395%2013.7271%208.20654%2014.127%208.7207%2014.127Z'%20fill='%23A6A6A6'/%3e%3c/svg%3e",ve="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='9'%20cy='9'%20r='9'%20fill='%23A6A6A6'/%3e%3cpath%20d='M5.97852%207.34766H7.47021C7.521%206.56055%208.04785%206.05908%208.8667%206.05908C9.6665%206.05908%2010.1997%206.54785%2010.1997%207.2207C10.1997%207.84912%209.93311%208.19189%209.146%208.66797C8.27002%209.18213%207.90186%209.75342%207.95898%2010.6929L7.96533%2011.1436H9.43799V10.7754C9.43799%2010.1406%209.67285%209.81055%2010.5044%209.32812C11.3677%208.81396%2011.8501%208.13477%2011.8501%207.16357C11.8501%205.76709%2010.6885%204.76416%208.94922%204.76416C7.06396%204.76416%206.0293%205.85596%205.97852%207.34766ZM8.7207%2014.127C9.23486%2014.127%209.64111%2013.7271%209.64111%2013.2256C9.64111%2012.7241%209.23486%2012.3306%208.7207%2012.3306C8.20654%2012.3306%207.79395%2012.7241%207.79395%2013.2256C7.79395%2013.7271%208.20654%2014.127%208.7207%2014.127Z'%20fill='%23F2F2F2'/%3e%3c/svg%3e",fe=["aria-label","aria-expanded"],ge=["src"],he=b({__name:"HelpTooltip",props:{text:{}},setup(e){const a=c(!1),t=c(null),l=u=>{const i=u.target;t.value&&!t.value.contains(i)&&(a.value=!1)},d=()=>{a.value=!a.value};return S(()=>{document.addEventListener("click",l)}),q(()=>{document.removeEventListener("click",l)}),(u,i)=>(f(),V("span",{ref_key:"triggerRef",ref:t,class:"help-tooltip"},[r("button",{type:"button",class:$(["help-tooltip__trigger",{"help-tooltip__trigger--active":a.value}]),"aria-label":e.text,"aria-expanded":a.value,onClick:Z(d,["stop"])},[r("img",{src:a.value?n(ve):n(pe),alt:"",class:"help-tooltip__icon"},null,8,ge)],10,fe),p(z,{name:"tooltip"},{default:h(()=>[J(r("div",{class:"help-tooltip__bubble",role:"tooltip"},F(e.text),513),[[G,a.value]])]),_:1})],512))}}),be=C(he,[["__scopeId","data-v-f02ed61c"]]),Ce=b({__name:"CvvInput",props:{name:{},label:{default:"CVV / CVC"},placeholder:{},tooltipText:{default:"Три цифры с обратной стороны карты"},error:{},modelValue:{}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-csc",placeholder:e.placeholder||"123",error:e.error,rules:n(L),"model-value":e.modelValue,formatter:n(me),parser:n(ie),maxlength:"4","onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"cvv-input"}),{labelSuffix:h(()=>[p(be,{text:e.tooltipText},null,8,["text"])]),_:1},16,["name","label","placeholder","error","rules","model-value","formatter","parser"]))}}),xe=C(Ce,[["__scopeId","data-v-95bc3329"]]),Ve=["checked"],ye={class:"checkbox__box","aria-hidden":"true"},_e={key:0,class:"checkbox__label"},ke=b({__name:"FormCheckbox",props:{modelValue:{type:Boolean},label:{}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,d=c(null),u=m=>{const v=m.target;l("update:modelValue",v.checked)},i=m=>{m.preventDefault(),l("update:modelValue",!t.modelValue),W(()=>{d.value?.focus({preventScroll:!0})})};return(m,v)=>(f(),V("label",{class:"checkbox",onClick:i},[r("input",{ref_key:"inputRef",ref:d,type:"checkbox",class:"checkbox__input",checked:e.modelValue,onChange:u},null,40,Ve),r("span",ye,[(f(),V("svg",{class:$(["checkbox__check",{"checkbox__check--visible":e.modelValue}]),viewBox:"0 0 12 10",fill:"none"},[...v[0]||(v[0]=[r("path",{d:"M1 5.5L4.5 9L11 1.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2))]),m.$slots.default||e.label?(f(),V("span",_e,[K(m.$slots,"default",{},()=>[y(F(e.label),1)])])):Q("",!0)]))}}),De=C(ke,[["__scopeId","data-v-493e62a1"]]),we=X("cardData",()=>{const e=c(null),a=c(!1),t=c(null),l=x(()=>!!e.value);function d(i){e.value={...i}}function u(){e.value=null}return{cardData:e,loading:a,error:t,hasCardData:l,setCardData:d,clearCardData:u}}),Ie={class:"order-payment-root"},Se={class:"order-payment-root__main"},$e={class:"order-payment-page"},Fe={class:"order-payment-page__main"},Ne={class:"payment-layout"},Be={class:"payment-form"},Pe={class:"form-row"},Te={class:"save-card-row"},Ae={class:"pay-section"},Ee=b({__name:"OrderPayment",setup(e){const a=we(),t=ae(),l=c(!1),d=c(!1),u=c(""),i=c(""),m=c(""),v=Y(),w=ee(),N=x(()=>{const s=(u.value||"").replace(/\s/g,""),o=(i.value||"").replace(/\s/g,"");return s.length>=16&&o.length>=4&&(m.value||"").replace(/\D/g,"").length>=3}),B=()=>{const s=localStorage.getItem("cardData");if(s){const o=JSON.parse(s);u.value=o.cardNumber}else return};S(()=>{B()});const P=x(()=>{const s=v.orderData?.amount;if(s==null)return"";const o=typeof s=="string"?parseInt(s,10):s;return isNaN(o)?"":j(o)+" ₽"}),T=x(()=>{const s=P.value;return s?`Оплатить ${s}`:"Оплатить"}),I=x(()=>!d.value&&N.value&&!w.hasErrors),A=async()=>{if(I.value){d.value=!0,a.loading=!0;try{l.value&&localStorage.setItem("cardData",JSON.stringify({cardNumber:u.value})),v.setPaymentStatus("success"),v.setPaymentPassed(!0),await new Promise(s=>setTimeout(s,2e3)),await t.push("/payment-result")}finally{d.value=!1,a.loading=!1}}};return(s,o)=>(f(),V("div",Ie,[r("div",Se,[r("div",$e,[r("div",Fe,[r("div",Ne,[p(O,{"has-shadow":!0},{logo:h(()=>[...o[4]||(o[4]=[r("img",{class:"card__logo-placeholder",src:oe,alt:"Bank logo"},null,-1)])]),default:h(()=>[r("div",Be,[p(ue,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=g=>u.value=g),name:"card-number",label:"Номер карты",placeholder:"1234 5678 9012 9999"},null,8,["modelValue"]),r("div",Pe,[p(ce,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=g=>i.value=g),name:"card-date",label:"Месяц / год",placeholder:"12 / 24"},null,8,["modelValue"]),p(xe,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=g=>m.value=g),name:"cvv",placeholder:"123"},null,8,["modelValue"])])])]),_:1}),r("div",Te,[p(De,{modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=g=>l.value=g)},{default:h(()=>[p(le,null,{default:h(()=>[...o[5]||(o[5]=[y("Сохранить карту для следующих покупок",-1)])]),_:1})]),_:1},8,["modelValue"])]),r("div",Ae,[p(H,{text:d.value?"Обработка...":T.value,loading:n(a).loading,disabled:!I.value,"has-form-errors":n(w).hasErrors,onClick:A},null,8,["text","loading","disabled","has-form-errors"]),o[6]||(o[6]=r("p",{class:"disclaimer"},[y(" Нажимая на кнопку «Оплатить», вы соглашаетесь с "),r("a",{href:"#",class:"disclaimer__link"},"условиями оферты")],-1))])])])])]),p(te,{"order-number":n(v).orderData?.orderId},null,8,["order-number"])]))}}),Oe=C(Ee,[["__scopeId","data-v-efa7f17f"]]);export{Oe as default};
