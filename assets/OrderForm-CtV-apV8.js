import{d as v,o as V,c as y,m as w,u,a as x,b as I,e as E,w as f,f as F,g as i,h as P,i as B,r as D,j as b,_ as O}from"./index-dK2CgAWm.js";import{P as q}from"./messages-BGBza2Ci.js";import{F as c,p as C,f as R,c as U,a as $,e as j,d as k,S as N,v as A}from"./validationRules-D4ZrcHwZ.js";const M=v({__name:"PriceInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean,default:!0},min:{default:0},max:{default:1/0},currency:{default:"₽"},showCurrency:{type:Boolean,default:!0}},emits:["update:modelValue","input"],setup(o){const m=o,n=x(()=>U(m.min,m.max,m.required));return(t,e)=>(V(),y(c,w({name:o.name,label:o.label,type:"text",placeholder:o.placeholder||"0",icon:o.icon,error:o.error,rules:n.value,"model-value":o.modelValue,formatter:u(R),parser:u(C),"onUpdate:modelValue":e[0]||(e[0]=s=>t.$emit("update:modelValue",s)),onInput:e[1]||(e[1]=s=>t.$emit("input",s))},t.$attrs,{class:"price-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),T=v({__name:"OrderForm",setup(o){localStorage.removeItem("orderData");const m=F(),n=I(),t=E(),e=D({amount:"",email:"",description:""}),s=b(!1),p=b(null),g=()=>{const l=A(e);if(!l.valid){for(const[r,a]of Object.entries(l.errors))n.addError(r,a);return null}return l.data},S=async()=>{s.value=!0,t.loading=!0,p.value=null;try{n.clearAllErrors();const l=document.querySelector('[name="amount"]'),r=document.querySelector('[name="email"]'),a=document.querySelector('[name="description"]');if(l?.blur(),r?.blur(),a?.blur(),n.hasErrors){console.log("Ошибки валидации:",n.allErrors);return}const d=g();if(!d)return;t.setOrderData(d),console.log("Заказ успешно создан:",d),await new Promise(h=>setTimeout(h,2e3)),await m.push("/payment")}catch(l){console.error("Ошибка при создании заказа:",l),p.value="Произошла ошибка при создании заказа. Пожалуйста, попробуйте снова."}finally{s.value=!1,t.loading=!1}};return(l,r)=>(V(),y(q,{"full-viewport":""},{default:f(()=>[i($,{"has-shadow":!0,title:"Создание заказа"},{default:f(()=>[P("form",{onSubmit:B(S,["prevent"]),class:"form"},[i(M,{modelValue:e.amount,"onUpdate:modelValue":r[0]||(r[0]=a=>e.amount=a),name:"amount",label:"Введите сумму заказа",placeholder:"0",icon:"₽"},null,8,["modelValue"]),i(c,{modelValue:e.email,"onUpdate:modelValue":r[1]||(r[1]=a=>e.email=a),name:"email",label:"Email",type:"email",placeholder:"example@mail.com",rules:u(j)},null,8,["modelValue","rules"]),i(c,{modelValue:e.description,"onUpdate:modelValue":r[2]||(r[2]=a=>e.description=a),name:"description",label:"Описание",type:"text",placeholder:"Что-то о заказе","max-lines":3,rules:u(k)},null,8,["modelValue","rules"]),i(N,{text:"Создать",type:"submit",disabled:s.value,"has-form-errors":u(n).hasErrors,loading:u(t).loading},null,8,["disabled","has-form-errors","loading"])],32)]),_:1})]),_:1}))}}),J=O(T,[["__scopeId","data-v-bf94c35d"]]);export{J as default};
