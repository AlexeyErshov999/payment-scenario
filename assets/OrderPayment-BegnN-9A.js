import{F as _,b as R,g as U,h as O,i as M,j as L,a as j,S as q,k as A}from"./validationRules--TMce_RF.js";import{d as h,o as f,c as y,m as D,u as d,_ as x,k as $,l as z,n as k,h as r,i as H,p as I,g as p,T as J,w as g,q as G,v as K,t as N,j as i,s as Q,x as W,y as C,z as X,A as Y,a as V,e as Z,b as ee,f as ae}from"./index-CNtApOi6.js";import{P as te}from"./messages-Cu240hq3.js";import{F as le,P as oe}from"./PaymentFooter-Da1oaT-Y.js";const re="/payment-scenario/assets/bank_logo-BycS5gqS.svg",ne=e=>e.replace(/\s/g,""),se=e=>(e.replace(/\D/g,"").match(/.{1,4}/g)||[]).join(" ").substr(0,19),ue=h({__name:"CardNumberInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),y(_,D({name:e.name,label:e.label,type:"text",placeholder:e.placeholder||"0000 0000 0000 0000",icon:e.icon,error:e.error,rules:d(R),"model-value":e.modelValue,formatter:d(se),parser:d(ne),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"card-number-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),de=x(ue,[["__scopeId","data-v-c4427637"]]),ce=h({__name:"ExpireDateInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),y(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-exp",placeholder:e.placeholder||"MM / ГГ",icon:e.icon,error:e.error,rules:d(M),"model-value":e.modelValue,formatter:d(O),parser:d(U),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"expire-date-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),ie=x(ce,[["__scopeId","data-v-bd8f1216"]]),me=e=>e.replace(/\D/g,"").slice(0,4),pe=e=>e.replace(/\D/g,""),ve=["aria-label","aria-expanded"],fe=h({__name:"HelpTooltip",props:{text:{}},setup(e){const a=i(!1),t=i(null),l=s=>{const u=s.target;t.value&&!t.value.contains(u)&&(a.value=!1)},c=()=>{a.value=!a.value};return $(()=>{document.addEventListener("click",l)}),z(()=>{document.removeEventListener("click",l)}),(s,u)=>(f(),k("span",{ref_key:"triggerRef",ref:t,class:"help-tooltip"},[r("button",{type:"button",class:I(["help-tooltip__trigger",{"help-tooltip__trigger--active":a.value}]),"aria-label":e.text,"aria-expanded":a.value,onClick:H(c,["stop"])},[...u[0]||(u[0]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),r("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)])],10,ve),p(J,{name:"tooltip"},{default:g(()=>[G(r("div",{class:"help-tooltip__bubble",role:"tooltip"},N(e.text),513),[[K,a.value]])]),_:1})],512))}}),be=x(fe,[["__scopeId","data-v-230e59e7"]]),ge=h({__name:"CvvInput",props:{name:{},label:{default:"CVV / CVC"},placeholder:{},tooltipText:{default:"Три цифры с обратной стороны карты"},error:{},modelValue:{}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),y(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-csc",placeholder:e.placeholder||"123",error:e.error,rules:d(L),"model-value":e.modelValue,formatter:d(pe),parser:d(me),maxlength:"4","onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"cvv-input"}),{labelSuffix:g(()=>[p(be,{text:e.tooltipText},null,8,["text"])]),_:1},16,["name","label","placeholder","error","rules","model-value","formatter","parser"]))}}),he=x(ge,[["__scopeId","data-v-95bc3329"]]),xe=["checked"],Ve={class:"checkbox__box","aria-hidden":"true"},ke={key:0,class:"checkbox__label"},ye=h({__name:"FormCheckbox",props:{modelValue:{type:Boolean},label:{}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,c=i(null),s=m=>{const v=m.target;l("update:modelValue",v.checked)},u=m=>{m.preventDefault(),l("update:modelValue",!t.modelValue),X(()=>{c.value?.focus({preventScroll:!0})})};return(m,v)=>(f(),k("label",{class:"checkbox",onClick:u},[r("input",{ref_key:"inputRef",ref:c,type:"checkbox",class:"checkbox__input",checked:e.modelValue,onChange:s},null,40,xe),r("span",Ve,[(f(),k("svg",{class:I(["checkbox__check",{"checkbox__check--visible":e.modelValue}]),viewBox:"0 0 12 10",fill:"none"},[...v[0]||(v[0]=[r("path",{d:"M1 5.5L4.5 9L11 1.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2))]),m.$slots.default||e.label?(f(),k("span",ke,[Q(m.$slots,"default",{},()=>[C(N(e.label),1)])])):W("",!0)]))}}),Ce=x(ye,[["__scopeId","data-v-493e62a1"]]),_e=Y("cardData",()=>{const e=i(null),a=i(!1),t=i(null),l=V(()=>!!e.value);function c(u){e.value={...u}}function s(){e.value=null}return{cardData:e,loading:a,error:t,hasCardData:l,setCardData:c,clearCardData:s}}),De={class:"order-payment-page"},Se={class:"order-payment-page__main"},we={class:"payment-layout"},$e={class:"payment-form"},Ie={class:"form-row"},Ne={class:"save-card-row"},Pe={class:"pay-section"},Be=h({__name:"OrderPayment",setup(e){const a=_e(),t=ae(),l=i(!1),c=i(!1),s=i(""),u=i(""),m=i(""),v=Z(),S=ee(),P=V(()=>{const n=(s.value||"").replace(/\s/g,""),o=(u.value||"").replace(/\s/g,"");return n.length>=16&&o.length>=4&&(m.value||"").replace(/\D/g,"").length>=3}),B=()=>{const n=localStorage.getItem("cardData");if(n){const o=JSON.parse(n);s.value=o.cardNumber}else return};$(()=>{B()});const F=V(()=>{const n=v.orderData?.amount;if(n==null)return"";const o=typeof n=="string"?parseInt(n,10):n;return isNaN(o)?"":A(o)+" ₽"}),T=V(()=>{const n=F.value;return n?`Оплатить ${n}`:"Оплатить"}),w=V(()=>!c.value&&P.value&&!S.hasErrors),E=async()=>{if(w.value){c.value=!0,a.loading=!0;try{l.value&&localStorage.setItem("cardData",JSON.stringify({cardNumber:s.value})),v.setPaymentStatus("success"),v.setPaymentPassed(!0),await new Promise(n=>setTimeout(n,2e3)),await t.push("/payment-result")}finally{c.value=!1,a.loading=!1}}};return(n,o)=>(f(),y(te,{"full-viewport":""},{default:g(()=>[r("div",De,[r("div",Se,[r("div",we,[p(j,{"has-shadow":!0},{logo:g(()=>[...o[4]||(o[4]=[r("img",{class:"card__logo-placeholder",src:re,alt:""},null,-1)])]),default:g(()=>[r("div",$e,[p(de,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=b=>s.value=b),name:"card-number",label:"Номер карты",placeholder:"1234 5678 9012 9999"},null,8,["modelValue"]),r("div",Ie,[p(ie,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=b=>u.value=b),name:"card-date",label:"Месяц / год",placeholder:"12 / 24"},null,8,["modelValue"]),p(he,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=b=>m.value=b),name:"cvv",placeholder:"123"},null,8,["modelValue"])])])]),_:1}),r("div",Ne,[p(Ce,{modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=b=>l.value=b)},{default:g(()=>[p(le,null,{default:g(()=>[...o[5]||(o[5]=[C("Сохранить карту для следующих покупок",-1)])]),_:1})]),_:1},8,["modelValue"])]),r("div",Pe,[p(q,{text:c.value?"Обработка...":T.value,loading:d(a).loading,disabled:!w.value,"has-form-errors":d(S).hasErrors,onClick:E},null,8,["text","loading","disabled","has-form-errors"]),o[6]||(o[6]=r("p",{class:"disclaimer"},[C(" Нажимая на кнопку «Оплатить», вы соглашаетесь с "),r("a",{href:"#",class:"disclaimer__link"},"условиями оферты")],-1))])]),p(oe,{"order-number":d(v).orderData?.orderId},null,8,["order-number"])])])]),_:1}))}}),Ue=x(Be,[["__scopeId","data-v-4596ac3c"]]);export{Ue as default};
