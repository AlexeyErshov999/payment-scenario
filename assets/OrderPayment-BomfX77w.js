import{b as M,F as _,g as R,h as U,i as L,j as O,a as H,S as j,k as q}from"./validationRules-BZb5Ckag.js";import{d as b,o as f,b as k,m as D,u as n,_ as C,p as $,q as Z,c as V,a as r,k as z,s as F,h as p,T as J,w as h,t as G,v as K,x as N,n as c,r as Q,y as W,z as X,A as y,B as Y,e as x,g as ee,f as ae,j as te}from"./index-BlzT3XFt.js";import{P as le,F as oe}from"./PaymentFooter-D6qOlGsK.js";import"./messages-D5fpFi7l.js";const I=["success","failed","service_error"],re=()=>{const e=Math.floor(Math.random()*I.length);return I[e]},se="/payment-scenario/assets/bank_logo-BycS5gqS.svg",ne=e=>e.replace(/\s/g,""),ue=e=>(e.replace(/\D/g,"").match(/.{1,4}/g)||[]).join(" ").substr(0,19),de=b({__name:"CardNumberInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",placeholder:e.placeholder||"0000 0000 0000 0000",icon:e.icon,error:e.error,rules:n(M),"model-value":e.modelValue,formatter:n(ue),parser:n(ne),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"card-number-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),ce=C(de,[["__scopeId","data-v-c4427637"]]),ie=b({__name:"ExpireDateInput",props:{name:{},label:{},placeholder:{},icon:{},error:{},modelValue:{},required:{type:Boolean}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-exp",placeholder:e.placeholder||"MM / ГГ",icon:e.icon,error:e.error,rules:n(L),"model-value":e.modelValue,formatter:n(U),parser:n(R),"onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"expire-date-input"}),null,16,["name","label","placeholder","icon","error","rules","model-value","formatter","parser"]))}}),me=C(ie,[["__scopeId","data-v-bd8f1216"]]),pe=e=>e.replace(/\D/g,"").slice(0,4),ve=e=>e.replace(/\D/g,""),fe="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='9'%20cy='9'%20r='9'%20fill='%23F2F2F2'/%3e%3cpath%20d='M5.97852%207.34766H7.47021C7.521%206.56055%208.04785%206.05908%208.8667%206.05908C9.6665%206.05908%2010.1997%206.54785%2010.1997%207.2207C10.1997%207.84912%209.93311%208.19189%209.146%208.66797C8.27002%209.18213%207.90186%209.75342%207.95898%2010.6929L7.96533%2011.1436H9.43799V10.7754C9.43799%2010.1406%209.67285%209.81055%2010.5044%209.32812C11.3677%208.81396%2011.8501%208.13477%2011.8501%207.16357C11.8501%205.76709%2010.6885%204.76416%208.94922%204.76416C7.06396%204.76416%206.0293%205.85596%205.97852%207.34766ZM8.7207%2014.127C9.23486%2014.127%209.64111%2013.7271%209.64111%2013.2256C9.64111%2012.7241%209.23486%2012.3306%208.7207%2012.3306C8.20654%2012.3306%207.79395%2012.7241%207.79395%2013.2256C7.79395%2013.7271%208.20654%2014.127%208.7207%2014.127Z'%20fill='%23A6A6A6'/%3e%3c/svg%3e",ge="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='9'%20cy='9'%20r='9'%20fill='%23A6A6A6'/%3e%3cpath%20d='M5.97852%207.34766H7.47021C7.521%206.56055%208.04785%206.05908%208.8667%206.05908C9.6665%206.05908%2010.1997%206.54785%2010.1997%207.2207C10.1997%207.84912%209.93311%208.19189%209.146%208.66797C8.27002%209.18213%207.90186%209.75342%207.95898%2010.6929L7.96533%2011.1436H9.43799V10.7754C9.43799%2010.1406%209.67285%209.81055%2010.5044%209.32812C11.3677%208.81396%2011.8501%208.13477%2011.8501%207.16357C11.8501%205.76709%2010.6885%204.76416%208.94922%204.76416C7.06396%204.76416%206.0293%205.85596%205.97852%207.34766ZM8.7207%2014.127C9.23486%2014.127%209.64111%2013.7271%209.64111%2013.2256C9.64111%2012.7241%209.23486%2012.3306%208.7207%2012.3306C8.20654%2012.3306%207.79395%2012.7241%207.79395%2013.2256C7.79395%2013.7271%208.20654%2014.127%208.7207%2014.127Z'%20fill='%23F2F2F2'/%3e%3c/svg%3e",he=["aria-label","aria-expanded"],be=["src"],Ce=b({__name:"HelpTooltip",props:{text:{}},setup(e){const a=c(!1),t=c(null),l=u=>{const i=u.target;t.value&&!t.value.contains(i)&&(a.value=!1)},d=()=>{a.value=!a.value};return $(()=>{document.addEventListener("click",l)}),Z(()=>{document.removeEventListener("click",l)}),(u,i)=>(f(),V("span",{ref_key:"triggerRef",ref:t,class:"help-tooltip"},[r("button",{type:"button",class:F(["help-tooltip__trigger",{"help-tooltip__trigger--active":a.value}]),"aria-label":e.text,"aria-expanded":a.value,onClick:z(d,["stop"])},[r("img",{src:a.value?n(ge):n(fe),alt:"",class:"help-tooltip__icon"},null,8,be)],10,he),p(J,{name:"tooltip"},{default:h(()=>[G(r("div",{class:"help-tooltip__bubble",role:"tooltip"},N(e.text),513),[[K,a.value]])]),_:1})],512))}}),xe=C(Ce,[["__scopeId","data-v-f02ed61c"]]),Ve=b({__name:"CvvInput",props:{name:{},label:{default:"CVV / CVC"},placeholder:{},tooltipText:{default:"Три цифры с обратной стороны карты"},error:{},modelValue:{}},emits:["update:modelValue","input"],setup(e){return(a,t)=>(f(),k(_,D({name:e.name,label:e.label,type:"text",inputmode:"numeric",autocomplete:"cc-csc",placeholder:e.placeholder||"123",error:e.error,rules:n(O),"model-value":e.modelValue,formatter:n(ve),parser:n(pe),maxlength:"4","onUpdate:modelValue":t[0]||(t[0]=l=>a.$emit("update:modelValue",l)),onInput:t[1]||(t[1]=l=>a.$emit("input",l))},a.$attrs,{class:"cvv-input"}),{labelSuffix:h(()=>[p(xe,{text:e.tooltipText},null,8,["text"])]),_:1},16,["name","label","placeholder","error","rules","model-value","formatter","parser"]))}}),ye=C(Ve,[["__scopeId","data-v-95bc3329"]]),_e=["checked"],ke={class:"checkbox__box","aria-hidden":"true"},De={key:0,class:"checkbox__label"},Se=b({__name:"FormCheckbox",props:{modelValue:{type:Boolean},label:{}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,d=c(null),u=m=>{const v=m.target;l("update:modelValue",v.checked)},i=m=>{m.preventDefault(),l("update:modelValue",!t.modelValue),X(()=>{d.value?.focus({preventScroll:!0})})};return(m,v)=>(f(),V("label",{class:"checkbox",onClick:i},[r("input",{ref_key:"inputRef",ref:d,type:"checkbox",class:"checkbox__input",checked:e.modelValue,onChange:u},null,40,_e),r("span",ke,[(f(),V("svg",{class:F(["checkbox__check",{"checkbox__check--visible":e.modelValue}]),viewBox:"0 0 12 10",fill:"none"},[...v[0]||(v[0]=[r("path",{d:"M1 5.5L4.5 9L11 1.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2))]),m.$slots.default||e.label?(f(),V("span",De,[Q(m.$slots,"default",{},()=>[y(N(e.label),1)])])):W("",!0)]))}}),we=C(Se,[["__scopeId","data-v-493e62a1"]]),Ie=Y("cardData",()=>{const e=c(null),a=c(!1),t=c(null),l=x(()=>!!e.value);function d(i){e.value={...i}}function u(){e.value=null}return{cardData:e,loading:a,error:t,hasCardData:l,setCardData:d,clearCardData:u}}),$e={class:"order-payment-root"},Fe={class:"order-payment-root__main"},Ne={class:"order-payment-page"},Be={class:"order-payment-page__main"},Pe={class:"payment-layout"},Te={class:"payment-form"},Ae={class:"form-row"},Ee={class:"save-card-row"},Me={class:"pay-section"},Re=b({__name:"OrderPayment",setup(e){const a=Ie(),t=te(),l=c(!1),d=c(!1),u=c(""),i=c(""),m=c(""),v=ee(),S=ae(),B=x(()=>{const s=(u.value||"").replace(/\s/g,""),o=(i.value||"").replace(/\s/g,"");return s.length>=16&&o.length>=4&&(m.value||"").replace(/\D/g,"").length>=3}),P=()=>{const s=localStorage.getItem("cardData");if(s){const o=JSON.parse(s);u.value=o.cardNumber}else return};$(()=>{P()});const T=x(()=>{const s=v.orderData?.amount;if(s==null)return"";const o=typeof s=="string"?parseInt(s,10):s;return isNaN(o)?"":q(o)+" ₽"}),A=x(()=>{const s=T.value;return s?`Оплатить ${s}`:"Оплатить"}),w=x(()=>!d.value&&B.value&&!S.hasErrors),E=async()=>{if(w.value){d.value=!0,a.loading=!0;try{l.value&&localStorage.setItem("cardData",JSON.stringify({cardNumber:u.value}));const s=re();v.setPaymentStatus(s),v.setPaymentPassed(!0),await new Promise(o=>setTimeout(o,2e3)),await t.push("/payment-result")}finally{d.value=!1,a.loading=!1}}};return(s,o)=>(f(),V("div",$e,[r("div",Fe,[r("div",Ne,[r("div",Be,[r("div",Pe,[p(H,{"has-shadow":!0},{logo:h(()=>[...o[4]||(o[4]=[r("img",{class:"card__logo-placeholder",src:se,alt:"Bank logo"},null,-1)])]),default:h(()=>[r("div",Te,[p(ce,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=g=>u.value=g),name:"card-number",label:"Номер карты",placeholder:"1234 5678 9012 9999"},null,8,["modelValue"]),r("div",Ae,[p(me,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=g=>i.value=g),name:"card-date",label:"Месяц / год",placeholder:"12 / 24"},null,8,["modelValue"]),p(ye,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=g=>m.value=g),name:"cvv",placeholder:"123"},null,8,["modelValue"])])])]),_:1}),r("div",Ee,[p(we,{modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=g=>l.value=g)},{default:h(()=>[p(oe,null,{default:h(()=>[...o[5]||(o[5]=[y("Сохранить карту для следующих покупок",-1)])]),_:1})]),_:1},8,["modelValue"])]),r("div",Me,[p(j,{text:d.value?"Обработка...":A.value,loading:n(a).loading,disabled:!w.value,"has-form-errors":n(S).hasErrors,onClick:E},null,8,["text","loading","disabled","has-form-errors"]),o[6]||(o[6]=r("p",{class:"disclaimer"},[y(" Нажимая на кнопку «Оплатить», вы соглашаетесь с "),r("a",{href:"#",class:"disclaimer__link"},"условиями оферты")],-1))])])])])]),p(le,{"order-number":n(v).orderData?.orderId},null,8,["order-number"])]))}}),je=C(Re,[["__scopeId","data-v-f2804316"]]);export{je as default};
